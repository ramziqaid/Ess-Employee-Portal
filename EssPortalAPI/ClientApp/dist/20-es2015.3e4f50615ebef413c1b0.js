(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{qTjg:function(t,c,e){"use strict";e.r(c),e.d(c,"AppChatsModule",function(){return et});var a=e("SVse"),n=e("iInd"),i=e("s7LF"),s=e("Dxy4"),o=e("PDjf"),r=e("Tj54"),h=e("e6WT"),l=e("SqCe"),u=e("rJgo"),d=e("q7Ft"),g=e("l0rg"),m=e("u9T3"),p=e("2Vo4"),b=e("XNiG"),f=e("itXk"),v=e("LRne"),C=e("eIep"),S=e("lJxs"),y=e("8Y7J"),I=e("IheW");class x{}let B=(()=>{class t{constructor(t){this.http=t,this.onContactSelected=new p.a(null),this.onUserUpdated=new b.a,this.onChatSelected=new p.a(null),this.onChatsUpdated=new b.a}loadChatData(){return Object(f.b)(this.getAllContacts(),this.getAllChats(),this.getCurrentUser(),(t,c,e)=>{this.contacts=t,this.chats=c,this.user=e,this.onUserUpdated.next(e)})}getChatByContact(t){const c=this.user.chatInfo.find(c=>c.contactId===t);return this.collectionLoading=!0,c?this.getAllChats().pipe(Object(C.a)(e=>{const a=e.find(t=>t.id===c.chatId),n=this.contacts.find(c=>c.id===t);return this.onChatSelected.next({chatCollection:a,contact:n}),this.collectionLoading=!1,Object(v.a)(a)})):this.createChatCollection(t).pipe(Object(C.a)(c=>this.getChatByContact(t)))}createChatCollection(t){const c=this.contacts.find(c=>c.id===t),e=(1e9*Math.random()).toString(),a={id:e,chats:[]},n={chatId:e,lastChatTime:new Date,contactId:c.id,contactName:c.name,unread:null};return this.http.post("api/chat-collections",Object.assign({},a)).pipe(Object(C.a)(t=>(this.user.chatInfo.push(n),this.updateUser(this.user).pipe(Object(C.a)(t=>this.getCurrentUser().pipe(Object(S.a)(t=>{this.user=t,this.onUserUpdated.next(t)})))))))}getAllContacts(){return this.http.get("api/contacts")}getAllChats(){return this.http.get("api/chat-collections")}getCurrentUser(){return this.http.get("api/chat-user").pipe(Object(S.a)(t=>t[0]))}updateUser(t){return this.http.put("api/chat-user/"+t.id,Object.assign({},t))}updateChats(t,c){return this.http.put("api/chat-collections",{id:t,chats:c})}autoReply(t){setTimeout(()=>{this.onChatsUpdated.next(t)},1500)}}return t.\u0275fac=function(c){return new(c||t)(y.lc(I.c))},t.\u0275prov=y.Xb({token:t,factory:t.\u0275fac}),t})();var U=e("/q54"),N=e("aLe/"),w=e("BSbQ"),O=e("ura0"),F=e("UhP/"),k=e("YyUd");const L=function(t){return{online:t}};function j(t,c){if(1&t){const t=y.ic();y.hc(0,"mat-list-item",8),y.pc("click",function(){y.Uc(t);const e=c.$implicit;return y.tc().getChatByContact(e.contactId)}),y.hc(1,"a",9),y.uc(2,"getValueByKey"),y.cc(3,"img",2),y.uc(4,"getValueByKey"),y.cc(5,"span",3),y.gc(),y.hc(6,"h6",10),y.fd(7),y.gc(),y.hc(8,"p",11),y.fd(9),y.uc(10,"date"),y.gc(),y.gc()}if(2&t){const t=c.$implicit,e=y.tc();y.Nb(1),y.Bc("ngClass",y.Hc(14,L,"online"===y.xc(2,4,e.contacts,t.contactId,"status"))),y.Nb(2),y.Bc("src",y.xc(4,8,e.contacts,t.contactId,"avatar"),y.Wc),y.Nb(4),y.gd(t.contactName),y.Nb(2),y.gd(y.vc(10,12,t.lastChatTime))}}function M(t,c){if(1&t){const t=y.ic();y.hc(0,"mat-list-item",8),y.pc("click",function(){y.Uc(t);const e=c.$implicit;return y.tc().getChatByContact(e.id)}),y.hc(1,"a",9),y.cc(2,"img",2),y.cc(3,"span",3),y.gc(),y.hc(4,"h6",10),y.fd(5),y.gc(),y.gc()}if(2&t){const t=c.$implicit;y.Nb(1),y.Bc("ngClass",y.Hc(3,L,"online"===t.status)),y.Nb(1),y.Bc("src",t.avatar,y.Wc),y.Nb(3),y.gd(t.name)}}let T=(()=>{class t{constructor(t,c){this.chatService=t,this.cdr=c,this.isSidenavOpen=!0,this.currentUser=new x}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(t=>{this.currentUser=t}),this.loadDataSub=this.chatService.loadChatData().subscribe(t=>{this.currentUser=this.chatService.user,this.contacts=this.chatService.contacts,this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.loadDataSub&&this.loadDataSub.unsubscribe()}getChatByContact(t){this.chatService.getChatByContact(t).subscribe(t=>{},t=>{console.log(t)})}}return t.\u0275fac=function(c){return new(c||t)(y.bc(B),y.bc(y.i))},t.\u0275cmp=y.Vb({type:t,selectors:[["app-chat-left-sidenav"]],decls:12,vars:4,consts:[["color","primary",1,"chat-sidebar-toolbar"],["href","",1,"toolbar-avatar","online"],["alt","",3,"src"],[1,"status-dot"],[1,"m-0","pl-16","font-normal","fz-1"],[1,"chat-sidebar-scroll",3,"perfectScrollbar"],["role","list",1,"inbox-nav-list"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["mat-list-avatar","",1,"toolbar-avatar",3,"ngClass"],["matLine",""],["matLine","",1,"text-muted"]],template:function(t,c){1&t&&(y.hc(0,"mat-toolbar",0),y.hc(1,"a",1),y.cc(2,"img",2),y.cc(3,"span",3),y.gc(),y.hc(4,"h6",4),y.fd(5),y.gc(),y.gc(),y.hc(6,"div",5),y.hc(7,"mat-nav-list",6),y.dd(8,j,11,16,"mat-list-item",7),y.gc(),y.cc(9,"mat-divider"),y.hc(10,"mat-nav-list",6),y.dd(11,M,6,5,"mat-list-item",7),y.gc(),y.gc()),2&t&&(y.Nb(2),y.Bc("src",c.currentUser.avatar,y.Wc),y.Nb(3),y.gd(c.currentUser.name),y.Nb(3),y.Bc("ngForOf",null==c.currentUser?null:c.currentUser.chatInfo),y.Nb(3),y.Bc("ngForOf",c.contacts))},directives:[g.a,N.b,l.g,a.p,w.a,l.d,l.b,a.o,O.a,F.k],pipes:[k.a,a.f],styles:[""]}),t})();var D=e("VDRc"),A=e("Q2Ze"),q=e("336X");const W=["msgForm"],V=["msgInput"],H=function(t){return{online:t}};function $(t,c){if(1&t&&(y.hc(0,"div",10),y.hc(1,"a",11),y.cc(2,"img",12),y.cc(3,"span",13),y.gc(),y.hc(4,"div",14),y.hc(5,"h6",15),y.fd(6),y.gc(),y.gc(),y.gc()),2&t){const t=y.tc();y.Nb(1),y.Bc("ngClass",y.Hc(3,H,"online"===t.activeContact.status)),y.Nb(1),y.Bc("src",t.activeContact.avatar,y.Wc),y.Nb(4),y.gd(t.activeContact.name)}}function z(t,c){if(1&t&&(y.hc(0,"a",30),y.cc(1,"img",31),y.cc(2,"span",13),y.gc()),2&t){const t=y.tc(3);y.Bc("ngClass",y.Hc(3,H,"online"===t.user.status)),y.Nb(1),y.Bc("src",null==t.user?null:t.user.avatar,y.Wc)("alt",null==t.user?null:t.user.name)}}function P(t,c){if(1&t&&(y.hc(0,"a",30),y.cc(1,"img",31),y.cc(2,"span",13),y.gc()),2&t){const t=y.tc(3);y.Bc("ngClass",y.Hc(3,H,"online"===t.activeContact.status)),y.Nb(1),y.Bc("src",null==t.activeContact?null:t.activeContact.avatar,y.Wc)("alt",null==t.activeContact?null:t.activeContact.name)}}function J(t,c){if(1&t&&(y.hc(0,"h5",32),y.fd(1),y.gc()),2&t){const t=y.tc(3);y.Nb(1),y.gd(null==t.activeContact?null:t.activeContact.name)}}function Q(t,c){if(1&t&&(y.hc(0,"h5",32),y.fd(1),y.gc()),2&t){const t=y.tc(3);y.Nb(1),y.gd(null==t.user?null:t.user.name)}}const R=function(t,c){return{sender:t,me:c}};function Y(t,c){if(1&t&&(y.hc(0,"div",25),y.dd(1,z,3,5,"a",26),y.dd(2,P,3,5,"a",26),y.hc(3,"div"),y.dd(4,J,2,1,"h5",27),y.dd(5,Q,2,1,"h5",27),y.hc(6,"div",28),y.fd(7),y.gc(),y.hc(8,"p",29),y.fd(9),y.uc(10,"relativeTime"),y.gc(),y.gc(),y.gc()),2&t){const t=c.$implicit,e=y.tc(2);y.Bc("ngClass",y.Ic(9,R,t.contactId===e.activeContact.id,t.contactId!==e.activeContact.id)),y.Nb(1),y.Bc("ngIf",t.contactId!==e.activeContact.id),y.Nb(1),y.Bc("ngIf",t.contactId===e.activeContact.id),y.Nb(2),y.Bc("ngIf",t.contactId===e.activeContact.id),y.Nb(1),y.Bc("ngIf",t.contactId!==e.activeContact.id),y.Nb(2),y.hd(" ",t.text," "),y.Nb(2),y.gd(y.vc(10,7,t.time))}}function G(t,c){if(1&t){const t=y.ic();y.hc(0,"div"),y.hc(1,"div",16),y.dd(2,Y,11,12,"div",17),y.gc(),y.cc(3,"mat-divider"),y.hc(4,"div",18),y.hc(5,"form",19,20),y.pc("ngSubmit",function(c){return y.Uc(t),y.tc().sendMessage(c)})("keydown.enter",function(c){return y.Uc(t),y.tc().sendMessage(c)}),y.hc(7,"mat-form-field",21),y.cc(8,"textarea",22,23),y.gc(),y.hc(10,"button",24),y.hc(11,"mat-icon"),y.fd(12,"send"),y.gc(),y.gc(),y.gc(),y.gc(),y.gc()}if(2&t){const t=y.tc();y.Nb(2),y.Bc("ngForOf",null==t.chatCollection?null:t.chatCollection.chats)}}function X(t,c){1&t&&(y.hc(0,"div",33),y.hc(1,"div",34),y.hc(2,"div",35),y.cc(3,"div",36),y.cc(4,"div",37),y.gc(),y.gc(),y.gc())}const _=function(){return{height:"220px",width:"220px",borderRadius:"50%"}},K=function(){return{height:"60px",width:"60px"}};function Z(t,c){1&t&&(y.hc(0,"div",38),y.hc(1,"mat-card",39),y.hc(2,"mat-icon",40),y.fd(3,"chat"),y.gc(),y.gc(),y.hc(4,"h6"),y.fd(5,"Select a contact!"),y.gc(),y.gc()),2&t&&(y.Nb(1),y.Bc("ngStyle",y.Gc(2,_)),y.Nb(1),y.Bc("ngStyle",y.Gc(3,K)))}let E=(()=>{class t{constructor(t,c){this.chatService=t,this.cdr=c,this.user=new x,this.activeContact=new x}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(t=>{this.user=t,this.cdr.markForCheck()}),this.chatSelectSub=this.chatService.onChatSelected.subscribe(t=>{t&&(this.chatCollection=t.chatCollection,this.activeContact=t.contact,this.initMsgForm(),this.cdr.markForCheck())}),this.chatUpdateSub=this.chatService.onChatsUpdated.subscribe(t=>{this.chatCollection.chats.push(t),this.scrollToBottom(),this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.chatSelectSub&&this.chatSelectSub.unsubscribe(),this.chatUpdateSub&&this.chatUpdateSub.unsubscribe()}sendMessage(t){if(!this.msgForm.form.value.message||!this.msgForm.form.value.message.trim().length)return;const c={contactId:this.chatService.user.id,text:this.msgForm.form.value.message,time:(new Date).toISOString()};this.chatCollection.chats.push(c),this.chatService.updateChats(this.chatCollection.id,[...this.chatCollection.chats]).subscribe(t=>{this.initMsgForm(),this.cdr.markForCheck()}),this.chatService.autoReply({contactId:this.activeContact.id,text:`Hi, I'm ${this.activeContact.name}. Your imaginary friend.`,time:(new Date).toISOString()})}initMsgForm(){setTimeout(()=>{this.msgForm&&this.msgForm.reset(),this.msgInput&&this.msgInput.first&&this.msgInput.first.nativeElement.focus(),this.scrollToBottom()})}scrollToBottom(){setTimeout(()=>{this.psContainer&&this.psContainer.update(),this.psContainer&&this.psContainer.scrollToBottom(0,400)})}}return t.\u0275fac=function(c){return new(c||t)(y.bc(B),y.bc(y.i))},t.\u0275cmp=y.Vb({type:t,selectors:[["app-chat-contents"]],viewQuery:function(t,c){if(1&t&&(y.jd(N.b,!0),y.jd(W,!0),y.jd(V,!0)),2&t){let t;y.Pc(t=y.qc())&&(c.psContainer=t.first),y.Pc(t=y.qc())&&(c.msgForm=t.first),y.Pc(t=y.qc())&&(c.msgInput=t)}},inputs:{matSidenav:"matSidenav"},decls:26,vars:9,consts:[["color","primary",1,"chat-toolbar"],["mat-icon-button","",1,"mr-16",3,"click"],["class","active-chat-user","fxLayout","row","fxLayoutAlign","start center",4,"ngIf"],["fxFlex",""],["mat-icon-button","",1,"topbar-button-right","hidden-on-open",3,"matMenuTriggerFor"],["toolbarDDMenu","matMenu"],["mat-menu-item",""],[4,"ngIf"],["class","chat-intro",4,"ngIf"],["class","chat-intro","fxLayout","column","fxLayoutAlign","center center",4,"ngIf"],["fxLayout","row","fxLayoutAlign","start center",1,"active-chat-user"],[1,"toolbar-avatar","mr-16",3,"ngClass"],["alt","",3,"src"],[1,"status-dot"],["fxLayout","column"],[1,"m-0","font-normal","fz-1"],[1,"conversations-hold",3,"perfectScrollbar"],["class","single-conversation","fxLayout","row",3,"ngClass",4,"ngFor","ngForOf"],[1,"chat-input-actions"],["fxLayout","row",1,"inputForm",3,"ngSubmit","keydown.enter"],["msgForm","ngForm"],[1,"full-width","mr-16"],["matInput","","required","","ngModel","","placeholder","Type your message","name","message","value","",1,"inputText"],["msgInput",""],["mat-fab","","color","primary","type","submit"],["fxLayout","row",1,"single-conversation",3,"ngClass"],["href","","class","toolbar-avatar",3,"ngClass",4,"ngIf"],["class","chat-username text-muted",4,"ngIf"],[1,"conversation-msg"],[1,"chat-date","text-muted"],["href","",1,"toolbar-avatar",3,"ngClass"],[3,"src","alt"],[1,"chat-username","text-muted"],[1,"chat-intro"],[1,"chat-loader"],[1,"spinner"],[1,"double-bounce1","mat-bg-accent"],[1,"double-bounce2","mat-bg-primary"],["fxLayout","column","fxLayoutAlign","center center",1,"chat-intro"],["fxLayout","row","fxLayoutAlign","center center",1,"text-center",3,"ngStyle"],["color","primary",1,"text-60",3,"ngStyle"]],template:function(t,c){if(1&t&&(y.hc(0,"mat-toolbar",0),y.hc(1,"button",1),y.pc("click",function(){return c.matSidenav.toggle()}),y.hc(2,"mat-icon"),y.fd(3,"short_text"),y.gc(),y.gc(),y.dd(4,$,7,5,"div",2),y.cc(5,"span",3),y.hc(6,"button",4),y.hc(7,"mat-icon"),y.fd(8,"more_vert"),y.gc(),y.gc(),y.hc(9,"mat-menu",null,5),y.hc(11,"button",6),y.hc(12,"mat-icon"),y.fd(13,"account_circle"),y.gc(),y.fd(14,"Contact info"),y.gc(),y.hc(15,"button",6),y.hc(16,"mat-icon"),y.fd(17,"volume_mute"),y.gc(),y.fd(18,"Mute"),y.gc(),y.hc(19,"button",6),y.hc(20,"mat-icon"),y.fd(21,"delete"),y.gc(),y.fd(22,"Clear chat"),y.gc(),y.gc(),y.gc(),y.dd(23,G,13,1,"div",7),y.dd(24,X,5,0,"div",8),y.dd(25,Z,6,4,"div",9)),2&t){const t=y.Qc(10);y.Nb(1),y.ad("align-self","center"),y.Nb(3),y.Bc("ngIf",c.activeContact.id),y.Nb(2),y.ad("align-self","center"),y.Bc("matMenuTriggerFor",t),y.Nb(17),y.Bc("ngIf",c.chatCollection&&!c.chatService.collectionLoading),y.Nb(1),y.Bc("ngIf",c.chatService.collectionLoading),y.Nb(1),y.Bc("ngIf",!c.chatCollection&&!c.chatService.collectionLoading)}},directives:[g.a,s.b,r.a,a.q,D.b,u.d,u.a,u.b,D.d,D.c,a.o,O.a,N.b,a.p,w.a,i.D,i.s,i.t,A.c,h.b,i.c,i.z,i.r,i.u,o.a,a.r,O.c],pipes:[q.a],styles:[""]}),t})();const tt=[{path:"",component:(()=>{class t{constructor(t,c){this.mediaObserver=t,this.chatService=c,this.isSidenavOpen=!0,this.activeChatUser={name:"Gevorg Spartak",photo:"assets/images/face-2.jpg",isOnline:!0,lastMsg:"Hello!"},this.user=c.user}ngOnInit(){this.chatSideBarInit()}ngOnDestroy(){this.screenSizeWatcher&&this.screenSizeWatcher.unsubscribe()}changeActiveUser(t){this.activeChatUser=t}updateSidenav(){var t=this;setTimeout(()=>{t.isSidenavOpen=!t.isMobile,t.sideNav.mode=t.isMobile?"over":"side"})}chatSideBarInit(){this.isMobile=this.mediaObserver.isActive("xs")||this.mediaObserver.isActive("sm"),this.updateSidenav(),this.screenSizeWatcher=this.mediaObserver.media$.subscribe(t=>{this.isMobile="xs"===t.mqAlias||"sm"===t.mqAlias,this.updateSidenav()})}}return t.\u0275fac=function(c){return new(c||t)(y.bc(U.g),y.bc(B))},t.\u0275cmp=y.Vb({type:t,selectors:[["app-chats"]],viewQuery:function(t,c){if(1&t&&y.jd(d.d,!0),2&t){let t;y.Pc(t=y.qc())&&(c.sideNav=t.first)}},decls:6,vars:2,consts:[[1,"p-0"],[1,"chat-container"],["mode","side",1,"chat-sidenav",3,"opened"],[1,"chats-wrap"],[3,"matSidenav"]],template:function(t,c){1&t&&(y.hc(0,"mat-card",0),y.hc(1,"mat-sidenav-container",1),y.hc(2,"mat-sidenav",2),y.cc(3,"app-chat-left-sidenav"),y.gc(),y.hc(4,"div",3),y.cc(5,"app-chat-contents",4),y.gc(),y.gc(),y.gc()),2&t&&(y.Nb(2),y.Bc("opened",c.isSidenavOpen),y.Nb(3),y.Bc("matSidenav",c.sideNav))},directives:[o.a,d.e,d.d,T,E],styles:[""],changeDetection:0}),t})(),data:{title:"Chat"}}];var ct=e("aYsj");let et=(()=>{class t{}return t.\u0275mod=y.Zb({type:t}),t.\u0275inj=y.Yb({factory:function(c){return new(c||t)},providers:[B],imports:[[a.c,i.l,d.g,u.c,h.c,r.b,s.c,l.e,g.b,o.g,m.a,N.c,ct.a,n.k.forChild(tt)]]}),t})()}}]);